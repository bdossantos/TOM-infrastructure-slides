<!--
Google IO 2012 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mahé <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
  <title>Refonte de l'infrastructure "The Optin Machine" // Benjamin Dos Santos</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="all" href="theme/css/custom.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  <!--
  <slide class="title-slide segue nobackground">
    <aside class="gdbar">
      <img src="images/google_developers_icon_128.png" />
    </aside>
    <hgroup class="auto-fadein">
      <h1 data-config-title></h1>
      <h2 data-config-subtitle></h2>
      <p data-config-presenter></p>
    </hgroup>
  </slide>
  -->

  <slide class="title-slide nobackground" id="home">
      <hgroup>
        <h1 id="main-title" class="centered">
          Refonte de l'infrastructure<br />
          "The Optin Machine"
        </h1>
      </hgroup>
      <footer class="auto-fadein">
        <!--
        <h1 data-config-title></h1>
        <h2 data-config-subtitle></h2>
        -->
        <p data-config-presenter></p>
      </footer>
  </slide>

  <!-- Qui ? -->
  <slide>
    <hgroup>
      <h2>Qui ?</h2>
    </hgroup>
    <article>
      <h3>Benjamin Dos Santos</h3><br/>
      <ul>
        <li>Administrateur système chez <a href="#">Arthur Media Group</a></li>
        <li>Développeur Web</li>
      </ul>
      <!--
      <ul id="tagscloud">
        <li>Sysadmin</li>
        <li>DevOps</li>
        <li>Webperf</li>
        <li>AWS</li>
        <li>InfrastructureAsCode</li>
        <li>Puppet</li>
        <li>Chef</li>
      </ul>
      -->
    </article>
  </slide>

  <!-- Présentation AMG -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        <p>Arthur Media Group est une société e-marketing d'une cinquantaine de
        collaborateurs regroupant plusieurs start-up aux activités diverses sur
        Internet</p>
      </section>
    </aside>

    <hgroup>
      <h2>Arthur Media Group</h2>
    </hgroup>
    <article id="amg">
      <h3>Régies :</h3><br/>
      <ul>
        <li><b style="color:#234E74;">P comme Performance</b></li>
        <li><b style="color:#D20D0D;">Mails &amp; Brands</b></li>
      </ul>

      <h3>Éditeur :</h3><br/>
      <ul>
        <li><b style="color:#A80F3F;">Welcome Media</b></li>
      </ul>

      <h3>Collecte :</h3><br/>
      <ul>
        <li><b style="color:#F68E03;">The Optin Machine</b></li>
      </ul>

      <!--<img src="images/AMG_schema.png" alt="" width="522" height="250" />-->
    </article>
  </slide>

  <!-- Présentation PCP -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        <p>Régies qui hébergent des bases de
        données e-mail clients et les rentabilise.</p>

        <p>Grâce à des outils de ciblage et en partenariat avec les principales
        plateformes d'affiliation, P comme Performance et Mails &amp; Brands
        réalisent des opérations de recrutement de nouveaux prospects qualifiés
        ainsi que des ventes directes.</p>

        <b>clients :</b>
        <ul>
          <li>
            Groupe Prisma Presse : Cuisine Actuelle, Femme Actuelle, Voici,
            Capital, Geo, Tele loisirs
          </li>
        </ul>
      </section>
    </aside>

    <hgroup>
      <h2>P comme Performance / Mails &amp; Brands</h2>
      <h3>Régies publicitaires e-mail à la performance</h3>
    </hgroup>
    <article id="pcp_mnb">
      <ul>
        <li>30 collaborateurs, 7 langues, 12 pays</li>
        <li>53 bases gérées : 23 M&amp;B + 30 PCP</li>
        <li>53 millions de profils</li>
        <li>2400 campagnes envoyées par mois</li>
        <li>
          112M++ de mails envoyés sur M&amp;B par mois
        </li>
        <li>20M++ de clics par mois</li>
        <li>
          Clients : Groupe Prisma Press, Groupe Webedia, Météo France, UGC ...
        </li>
      </ul>
    </article>
  </slide>

  <!-- Présentation WM -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        <p>Welcome Media se consacre à la création de newsletters et sites
        thématiques. Les thèmes : Télé, météo, ventes privées, actualité insolite,
        applications mobiles..</p>

        <p>Présence en France, Italie et Espagne</p>
      </section>
    </aside>

    <hgroup>
      <h2>Welcome Media</h2>
      <h3>Éditeur</h3>
    </hgroup>
    <article id="wm">
      <ul>
        <li>Génération de Trafic Nielsen, Cliques, Lead</li>
        <li>Édition de site web :
          <ul>
            <li>
               <a href="http://www.programmi-tv.com">Programmi TV</a>,
               <a href="http://dailygeekshow.com/">Daily geek show</a>,
               <a href="http://www.programacion-tv.es/">Programación-TV</a>,
               <a href="http://www.application-du-jour.com/">Application du jour</a>
            </li>
          </ul>
        </li>
        <li>Édition de Newletters :
          <ul>
            <li>
              Météo France, Ventes Privées du jour, 20minutes, Le Figaro,
              NRJ, Marie Claire, Cosmopolitan ...
            </li>
          </ul>
        </li>
        <li>9M de profil</li>
      </ul>
    </article>
  </slide>

  <!-- Présentation TOM -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        <p>TOM est une société spécialisée dans la création de
        solutions dédiées afin de construire de nouveaux actifs clients.</p>
        <br />
        <ul>
          <li>
            Outils clés en mains pour collecter des profils : overlay, outils
            de recommandation, etc ...
          </li>
          <li>
            Technologie de jeux-concours pour réduire les coûts et accélérer les
            temps de lancement
          </li>
          <li>
            Expertise d’association de marques pour réduire les coûts de
            collecte
          </li>
          <li>
            Technologie d’enquête à vocation de collecte de données
            (ex : Grande enquête sur la santé des femmes)
          </li>
          <li>Technologie de mini-sites spécialisés en collecte </li>
          <li>Outils de monétisations d’audience : coregistration, overlay etc .</li>
        </ul>
      </section>
    </aside>

    <hgroup>
      <h2>The Optin Machine</h2>
      <h3>Collecte</h3>
    </hgroup>
    <article id="tom">
      <ul>
        <li>Recrutement d'adresse via Overlays, enquêtes, jeux concours</li>
        <li>Livraison des profils collectés</li>
        <li>4 millions d´emails recrutés en 2010</li>
        <li>Plus de 50 opérations de collectes pour nos différents clients</li>
        <li>Plus d´1 milliard d´impressions</li>
        <li>600 opérations par mois</li>
      </ul>
    </article>
  </slide>

  <!-- Quoi -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        <p>Courant 2011, l'infrastructure de la société The Optin Machine a démontré
        des problèmes de performance et de disponibilité.</p>

        <p>Afin de développer l’activité il a été décidé de refondre et moderniser
        cette dernière pour permettre de :</p>
        <br />
        <ul>
          <li>augmenter les diffusions</li>
          <li>augmenter la capacité de collecte</li>
          <li>diversifier les supports de collecte : enquêtes</li>
        </ul>
      </section>
    </aside>

    <hgroup>
      <h2>Mon rôle chez Arthur Media</h2>
    </hgroup>
    <article>
      <ul>
        <li>Déploiement et administration des infrastructures du groupe</li>
        <li>Mise en place d’infrastructures haute disponibilité</li>
        <li>Déploiement d'outils de supervision</li>
        <li>Intégration de bonnes pratiques comme infrastructure as code et DevOps</li>
      </ul>
    </article>
  </slide>

  <!-- Description projet -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        <p>Courant 2011, l'infrastructure a démontré des problèmes de performance et
        de disponibilité.</p>

        <p>Afin de développer l'activité il a été décidé de refondre et moderniser
        cette dernière pour permettre de :</p>

        <ul>
          <li>augmenter les diffusions</li>
          <li>augmenter la capacité de collecte</li>
          <li>diversifier les supports de collecte : enquêtes ...</li>
        </ul>
      </section>
    </aside>

    <hgroup>
      <h2>Présentation du projet</h2>
    </hgroup>
    <article>
      <h3>
        Refonte de l'infrastructure de la société
        <span style="color:#F68E03;">The Optin Machine</span> :
      </h3>
      <br />
      <ul>
        <li>Base de Collecte</li>
        <li>Supports de Collecte</li>
        <li>Tracking</li>
        <li>Serveurs "statiques"</li>
      </ul>
    </article>
  </slide>

  <!-- Présentation de l'existant, schéma -->
  <slide class="nobackground">
    <!-- note -->
    <aside class="note">
      <section>
        <ul>
          <li>1 * Serveur d'application (Apache, PHP ...)
            <ul>
              <li>Jeux, Overlays ...</li>
              <li>Tracking</li>
            </ul>
          </li>
          <li>1 * Serveur de Tracking</li>
          <li>2 * Base de données MySQL :
            <ul>
              <li>
                1 * Maître pour l'écriture
              </li>
              <li>
                1 * Esclave pour la lecture
              </li>
            </ul>
          </li>
          <li>4 * Serveurs statiques
            <ul>
              <li>Round Robin pour l'équilibrage de charge</li>
            </ul>
          </li>
        </ul>
      </section>
    </aside>

    <hgroup>
      <h2>L'existant</h2>
    </hgroup>
    <article class="flexbox vcenter">
      <a href="https://cacoo.com/diagrams/dND4SXZLkcGWQnaI-53920.png" style="border:0;">
        <img src="images/tom-old.png" alt="" width="849" height="473" />
      </a>
    </article>
  </slide>

  <!-- Les limites de l'existant : HA -->
  <slide>
    <hgroup>
      <h2>Limites / Inconvénients</h2>
    </hgroup>
    <article>
      <h3 class="red">La Haute Disponibilité :</h3><br/>
      <ul>
        <li><strong>SPOF</strong> au niveau de la collecte, tracking et base de données</li>
      </ul>

      <h3 class="red">Tracking instable :</h3><br />
      <ul>
        <li>Fuites de mémoire</li>
        <li>Crash du service</li>
        <li>Redémarrage de la machine</li>
      </ul>
    </article>
  </slide>

  <!-- Les limites de l'existant : DB -->
  <slide>
    <hgroup>
      <h2>Limites / Inconvénients</h2>
    </hgroup>
    <article>
      <h3 class="red">La base de données MySQL :</h3><br />
      <ul>
        <li>Champs mal indexés</li>
        <li>Tables utilisant le moteur MyISAM :
          <ul>
            <li>Table individus verrouillée en écriture</li>
            <li>Entassement des requêtes INSERT en file d'attente</li>
            <li>Perte d'informations à cause des délais d'attente expirés</li>
          </ul>
        </li>
        <li>Schéma inadapté aux nouveaux supports de collecte : enquêtes ...</li>
        <li>Manque de souplesse du modèle relationnelle</li>
      </ul>
    </article>
  </slide>

  <!-- Les limites de l'existant : Operations -->
  <slide>
    <hgroup>
      <h2>Limites / Inconvénients</h2>
    </hgroup>
    <article>
      <h3 class="red">Opération sur la base de données :</h3><br />
      <ul>
        <li>Répliquer nécessite de verrouiller le maître en écriture ...</li>
        <li>70 GO de données ...</li>
        <li>Sauvegardes à chaud :
          <ul>
            <li>MySQL Dump : long à effectuer, lent à restaurer</li>
            <li>Snapshot ? Nous n'utilisons (malheureusement) pas LVM, RDS etc ...</li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <!-- Objectifs -->
  <slide>
    <hgroup>
      <h2>Objectifs de la refonte</h2>
    </hgroup>
    <article>
      <ul class="no_bullet build">
        <li><h3>- Améliorer la disponibilité de l'infrastructure</h3></li>
        <li><h3>- Gestion des configurations</h3></li>
        <li><h3>- Orchestration des serveurs</h3></li>
      </ul>
    </article>
  </slide>

  <!-- Étude des solutions : DB -->
  <slide>
    <hgroup>
      <h2>Étude des solutions</h2>
      <h3>Base de données de collecte</h3>
    </hgroup>
    <article>
      <h4>Bases de données NoSQL orientées document :</h4><br/>
      <ul>
        <li><strong>MongoDB</strong></li>
        <li><strong>CouchDB</strong></li>
      </ul>
    </article>
    <footer class="source">
      <a href="http://www.mongodb.org/display/DOCS/Comparing+Mongo+DB+and+Couch+DB">
        Comparing Mongo DB and CouchDB
      </a>
    </footer>
  </slide>

  <!-- Étude des solutions : Tracking -->
  <slide>
    <hgroup>
      <h2>Étude des solutions</h2>
      <h3>Tracking</h3>
    </hgroup>
    <article>
      <ul>
        <li>Continuer avec <strong>Nodejs</strong> ?</li>
        <li>
          Logs vs bases de données clef-valeur distribuées :<br/>
          <ul>
            <li><strong>Redis</strong></li>
            <li><strong>Memcached</strong></li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <!-- Étude des solutions : Statiques -->
  <slide>
    <hgroup>
      <h2>Étude des solutions</h2>
      <h3>Serveurs statiques</h3>
    </hgroup>
    <article>
      <ul>
        <li>Lighttpd vs Nginx</li>
        <li>Rsync</li>
      </ul>
    </article>
  </slide>

  <!-- Technologies retenues : statiques -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        <p>
          la technique du DNS Round-Robin (en français tourniquet)
          consiste à associer plusieurs adresses IP à un nom de domaine.
        </p>

        <p>
          Une rotation circulaire entre ces différentes adresses permet ainsi
          de répartir la charge générée par ce trafic important entre les
          différentes machines ayant ces adresses IP.
        </p>
        <p>
          Il faut cependant nuancer
          cette répartition car elle n'a lieu qu'à la résolution du nom d'hôte
          et reste par la suite en cache sur les différents resolvers
          (client DNS).
        </p>
      </section>
    </aside>

    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Serveurs statiques</h3>
    </hgroup>
    <article id="statiques">
      <ul>
        <li><strong>Nginx</strong></li>
        <li><strong>NAS</strong> haute disponibilité</li>
        <li><strong>Load balancing</strong> via <strong>Weighted round robin</strong></li>
      </ul>
    </article>
  </slide>

  <!-- Technologies retenues : DB -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Base de données de collecte</h3>
    </hgroup>
    <article id="couchdb">
      <q>
        Apache <a href="http://couchdb.apache.org/">CouchDB</a>™ is a database
        that uses JSON for documents,
        JavaScript for MapReduce queries,
        and regular HTTP for an API
      </q>
    </article>
  </slide>

  <!-- Technologies retenues : Supports de collecte -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Supports de collectes</h3>
    </hgroup>
    <article id="collecte">
      <ul>
        <li><strong>Nginx</strong> : serveur web en frontal</li>
        <li><strong>PHP-FPM</strong> : traitement des requêtes avec PHP</li>
        <li><strong>REST</strong> : enregistrement des données sur CouchDB avec CURL</li>
      </ul>
    </article>
  </slide>

  <!-- Technologies retenues : Tracking -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Tracking</h3>
    </hgroup>
    <article id="tracking">
      <ul>
        <li><strong>Nginx</strong> : serveur web en frontal</li>
        <li><strong>PHP-FPM</strong> : traitement des requêtes dynamiques</li>
        <li><strong>Redis</strong> : enregistrement des affichages et cliques</li>
        <li><strong>REST</strong> : agrégation des statistiques de chaque noeud</li>
      </ul>
    </article>
  </slide>

  <!-- Technologies retenues : infrastructure as code -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Gestion des configurations</h3>
    </hgroup>
    <article id="configs">
      <ul>
        <li>
          <strong>Puppet</strong> : modules dédiés à chaque brique de
          l'infrastructure :
          <br />
          <ul>
            <li>Bases de données</li>
            <li>Serveur statiques</li>
            <li>Serveurs de Tracking</li>
          </ul>
        </li>
        <li><strong>Git + Github</strong> : contrôle de version, déploiement</li>
      </ul>
    </article>
  </slide>

  <!-- Technologies retenues : infrastructure as code, exemple de module -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Gestion des configurations : extrait module</h3>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="ruby">
      class tom_static {
        package { 'nginx-full':
          ensure  => 'installed',
        }

        service { 'nginx':
          ensure  => running,
          enable  => true,
          require => Package['nginx-full'];
        }

        file { '/etc/nginx/nginx.conf':
          ensure  => 'file',
          content => template('tom_static/etc/nginx/nginx.conf.erb'),
          notify  => Service['nginx'],
          require => Package['nginx-full'];
        }
        # rest of code ...
      }
      </pre>
    </article>
  </slide>

  <!-- Technologies retenues : Puppet roles -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Classification des serveurs par rôle avec Puppet</h3>
    </hgroup>
    <article>
      <a href="#">
        <img src="images/puppet_modules.png" alt="Puppet modules" width="424" height="444" class="centered"/>
      </a>
    </article>
  </slide>

  <!-- Technologies retenues : Puppet roles -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Classification des serveurs par rôle avec Puppet</h3>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="ruby">
      # Base node
      node base {
        include init_host, sysctl_tuning, rsyslog, munin, nagios
      }

      # All
      node default inherits base {}

      # DB
      node '/^db\d+\.optin-machine\.fr$/' {
        class { 'couchdb':
          bind => '0.0.0.0',
        }
      }

      # Statics
      node '/^static\d+\.optin-machine\.fr$/' {
        include tom_static
      }
      </pre>
    </article>
  </slide>

  <!-- Technologies retenues : Environnement "Production like" -->
  <!--
  <slide>
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Vagrant</h3>
    </hgroup>
    <article id="vagrant">
      <h4>
        Création et configuration d'environnement
        de développement reproductible et portable.
      </h4>
      </br />
      <p>pré-requis :</p>
      <ul>
        <li><a href="http://www.virtualbox.org/">Oracle's VirtualBox</a></li>
        <li>Ruby 1.8 +</li>
        <li>
          <a href="http://vagrantup.com/">Vagrant</a> :
          <code>gem install vagrant</code>
        </li>
      </ul>
    </article>
  </slide>
  -->

  <!-- Technologies retenues : Environnement "Production like" -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Environnement "Production like" avec Virtualbox, Vagrant et Puppet</h3>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="ruby">
      # https://github.com/Benjamin-Ds/test-couchdb-elasticsearch/blob/master/Vagrantfile
      Vagrant::Config.run do |config|
        config.vm.box = "squeeze64"
        config.vm.box_url = "https://domain.tld/vagrantboxes/squeeze64.box"

        config.vm.provision :puppet do |puppet|
          puppet.manifests_path = "manifests"
          puppet.module_path = "~/Code/puppet/modules"
          puppet.manifest_file = "site.pp"
          puppet.options = "--verbose"
        end

        config.vm.define :couchdb do |couchdb_config|
          couchdb_config.vm.host_name = "couchdb"
          couchdb_config.vm.network :hostonly, "192.168.33.10"
          couchdb_config.vm.forward_port 5984, 5984
          couchdb_config.vm.forward_port 9200, 9200
        end
      end
      </pre>
    </article>
  </slide>

  <!-- Technologies retenues : orchestration -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Orchestration des serveurs / déploiements avec Fabric</h3>
    </hgroup>
    <article id="python">
      <q>
        Fabric is a Python (2.5 or higher) library and command-line tool for streamlining
        the use of SSH for application deployment or systems administration tasks.
      </q>
    </article>
  </slide>

  <!-- Technologies retenues : orchestration -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Orchestration / déploiement des serveurs avec Fabric</h3>
    </hgroup>
    <article class="smaller">
      <ul>
        <li>Déploiement des applications et modules Puppet depuis Github</li>
        <li>Configuration des machines avec Puppet</li>
        <li>Mise à jour des serveurs, redémarrage des services ...</li>
      </ul>
      <br />
      <pre class="prettyprint" data-lang="shell">
      # Configuration automatique grâce au fichier de classification
      fab -H db01.optin-machine.fr configure:site='/etc/puppet/manifests/site.pp'

      # Configuration manuel avec liste des modules à utiliser
      fab -H db01.optin-machine.fr configure:modules='couchdb,munin,nagios'

      # Déploiement de code depuis le SCM
      fab -H front01.domain.tld -A \
      deploy:repo='git@github.com:ArthurMediaGroup/www.programma-tv.com.git', \
      dest='/home/http/www.programma-tv.com'
      </pre>
    </article>
  </slide>

  <!-- Technologies retenues : orchestration -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Orchestration / déploiement des serveurs avec Fabric</h3>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="python">
      def puppet_apply(module='', args='', options='--modulepath /etc/puppet/modules'):
          """
          Apply Puppet module

          eg : fab -R db puppet_apply:module=couchdb
          """
          if module != '':
              print(green("Apply '%s' Puppet module to %s" % (module, env.host_string)))
              options += ' --logdest console --logdest syslog'
              run("puppet apply -e 'include %(module)s %(args)s' %(options)s" % locals())
          else:
              abort(red('Module name required !'))
      </pre>
    </article>
  </slide>

  <!-- Technologies retenues : Superivion : monitoring actif avec Nagios -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Supervision : Shinken + Thruk</h3>
    </hgroup>
    <article class="">
      <img src="images/shinken_thruk.png" alt="thruk" class="centered"/>
    </article>
  </slide>

  <!-- Technologies retenues : Superivion : graphs avec Munin -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Supervision : graphiques avec Munin</h3>
    </hgroup>
    <article>
      <ul>
        <li>Charge cpu, disque, RAM, interfaces réseaux, requêtes HTTP/s ...</li>
        <li>Agrégation des graphiques des machines du même "pool"</li>
      </ul>
      <div class="centered"><img src="images/nginx_requests-day.png" alt="nginx requests" /></div>
    </article>
  </slide>

  <!-- Supervision : centralisation des Logs -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Technologies retenues</h2>
      <h3>Supervision : centralisation des Logs</h3>
    </hgroup>
    <article>
      <div class="centered">
        <a href="https://papertrailapp.com/" style="border:0;">
          <img src="images/papertrail_diagram.png" alt="Papertrail" />
        </a>
      </div>
    </article>
  </slide>

  <!-- Infra -->
  <slide class="nobackground">
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Infrastructure actuelle</h2>
    </hgroup>
    <article class="centered" id="current_infra">
      <a href="https://cacoo.com/diagrams/CgiH0LrzglxVdMmx-53920.png" style="border:0;">
        <img src="images/tom-current.png" alt="TOM current infra" width="960" height="553" />
      </a>
    </article>
  </slide>

  <!-- Déploiement -->
  <slide>
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Déploiement</h2>
      <h3>Hardware : Serveurs dédiés <a hrf="http://www.ovh.com">OVH</a></h3>
    </hgroup>
    <article id="ovh">
      <ul>
        <li>DB : 4 *
              <a href="http://www.ovh.com/fr/serveurs_dedies/superplan_best_of.xml">
                SP Best Of
              </a>
        </li>
        <li>
          Tracking : 2 *
              <a href="http://www.ovh.com/fr/serveurs_dedies/superplan_ssd.xml">
                SP SSD
              </a>
        </li>
        <li>
          Front : 2 *
              <a href="http://www.ovh.com/fr/serveurs_dedies/superplan_best_of.xml">
                SP Best OF
              </a>
        </li>
        <li>
          Statiques :
          <ul>
            <li>
              4 *
              <a href="http://www.ovh.com/fr/serveurs_dedies/superplan_mini.xml">
                SP Mini
              </a>
            </li>
            <li>
              1 *
              <a href="http://www.ovh.com/fr/nas/stockages_NAS_HA_Hybrid.xml">
                NAS Hybride HA
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <!-- Conclusion et perspectives : Résultats obtenus et avantages apportés -->
  <slide class="nobackground">
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Conclusion</h2>
      <h3>Résultats obtenus et avantages apportés</h3>
    </hgroup>
    <article>
      <ul>
        <li>La configuration de toutes les machines est standardisée</li>
        <li>Les configurations sont sous contrôle de version</li>
        <li>L'administration de l'infrastructure est centralisée</li>
        <li>Les déploiements sont facilités et automatisés</li>
        <li>Cette infrastructure est <strong>haute disponibilité</strong> et <strong>Scalable</strong> horizontalement</li>
        <li>En production depuis septembre 2011</li>
      </ul>
    </article>
  </slide>

  <!-- Conclusion et perspectives : Difficultés rencontrées -->
  <slide class="nobackground">
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Conclusion</h2>
      <h3>Difficultés rencontrées</h3>
    </hgroup>
    <article>
      <ul>
        <li>Instabilités CouchDB</li>
        <li>Formation sur le tas à des nouvelles technologies : nosql etc ...</li>
        <li>Délais de réalisation court</li>
      </ul>
    </article>
  </slide>

  <!-- Perspectives-->
  <slide class="nobackground">
    <!-- note -->
    <aside class="note">
      <section>
        
      </section>
    </aside>
    
    <hgroup>
      <h2>Perspectives</h2>
    </hgroup>
    <article id="cloud">
      <h3>Le cloud publique</h3>
      <br />
      <ul>
        <li>Agilité et élasticité instantanée</li>
        <li>Economique grâce à la facturation à l’usage</li>
      </ul>
    </article>
  </slide>

  <slide class="thank-you-slide segue nobackground">
    <article class="flexbox vleft auto-fadein">
      <h2>&lt;Merci !&gt;</h2>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="logoslide dark nobackground">
    <article class="flexbox vcenter">
      <h2 style="color: #fff;">Questions ?</h2>
    </article>
  </slide>

  <slide class="backdrop"></slide>
</slides>

<script>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-9203113-4']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>